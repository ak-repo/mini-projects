<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Go 1-to-1 WebSocket Chat</title>
  </head>
  <body>
    <h2>1-to-1 Chat Demo</h2>

    <label>Your User ID:</label>
    <input id="userId" placeholder="user1" />
    <button onclick="connect()">Connect</button>

    <hr />

    <label>Send To (User ID):</label>
    <input id="toUser" placeholder="user2" />

    <br /><br />

    <label>Message:</label>
    <input id="message" />
    <button onclick="sendMessage()">Send</button>

    <pre id="log"></pre>

    <script>
      let socket = null;

      function connect() {
        const userId = document.getElementById("userId").value;
        if (!userId) {
          alert("Enter user ID");
          return;
        }

        socket = new WebSocket("ws://localhost:8080/ws?user_id=" + userId);

        socket.onopen = () => {
          log("Connected as " + userId);
        };

        socket.onmessage = (event) => {
          const data = JSON.parse(event.data);
          log("From " + data.from + ": " + data.message);
        };

        socket.onclose = () => {
          log("Connection closed");
        };

        socket.onerror = (err) => {
          log("Error occurred");
        };
      }

      function sendMessage() {
        if (!socket) {
          alert("Not connected");
          return;
        }

        const to = document.getElementById("toUser").value;
        const message = document.getElementById("message").value;

        const payload = {
          to: to,
          message: message,
        };

        socket.send(JSON.stringify(payload));
        log("To " + to + ": " + message);
        document.getElementById("message").value = "";
      }

      function log(msg) {
        document.getElementById("log").textContent += msg + "\n";
      }
    </script>
  </body>
</html>
